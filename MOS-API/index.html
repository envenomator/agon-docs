
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.21">
    
    
      
        <title>What is the MOS API - Community Agon Platform documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#what-is-the-mos-api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Community Agon Platform documentation" class="md-header__button md-logo" aria-label="Community Agon Platform documentation" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Community Agon Platform documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              What is the MOS API
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/AgonConsole8/agon-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    contribute
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Community Agon Platform documentation" class="md-nav__button md-logo" aria-label="Community Agon Platform documentation" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    Community Agon Platform documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/AgonConsole8/agon-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    contribute
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Welcome & getting started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Welcome & getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Start here
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../FAQ/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Theory-of-operation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Theory of operation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../MOS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MOS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../VDP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VDP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../BBC-BASIC-for-Agon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BBC Basic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GPIO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GPIO
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Updating-Firmware-from103/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Updating Firmware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Updating-Firmware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Updating Firmware (prio v1.03)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Additional resources
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Additional resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../External-Documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    External documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Third-Party-Projects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Third party projects
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#usage-from-z80-assembler" class="md-nav__link">
    <span class="md-ellipsis">
      Usage from Z80 assembler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage from Z80 assembler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rst-08h-execute-a-mos-command" class="md-nav__link">
    <span class="md-ellipsis">
      RST 08h: Execute a MOS command
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rst-10h-output-a-single-character-to-the-vdp" class="md-nav__link">
    <span class="md-ellipsis">
      RST 10h: Output a single character to the VDP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rst-18h-output-a-stream-of-characters-to-the-vdp-mos-103-or-above" class="md-nav__link">
    <span class="md-ellipsis">
      RST 18h: Output a stream of characters to the VDP (MOS 1.03 or above)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-mos-api" class="md-nav__link">
    <span class="md-ellipsis">
      The MOS API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The MOS API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#0x00-mos_getkey" class="md-nav__link">
    <span class="md-ellipsis">
      0x00: mos_getkey
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x01-mos_load" class="md-nav__link">
    <span class="md-ellipsis">
      0x01: mos_load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x02-mos_save" class="md-nav__link">
    <span class="md-ellipsis">
      0x02: mos_save
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x03-mos_cd" class="md-nav__link">
    <span class="md-ellipsis">
      0x03: mos_cd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x04-mos_dir" class="md-nav__link">
    <span class="md-ellipsis">
      0x04: mos_dir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x05-mos_del" class="md-nav__link">
    <span class="md-ellipsis">
      0x05: mos_del
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x06-mos_ren" class="md-nav__link">
    <span class="md-ellipsis">
      0x06: mos_ren
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x07-mos_mkdir" class="md-nav__link">
    <span class="md-ellipsis">
      0x07: mos_mkdir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x08-mos_sysvars" class="md-nav__link">
    <span class="md-ellipsis">
      0x08: mos_sysvars
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x09-mos_editline" class="md-nav__link">
    <span class="md-ellipsis">
      0x09: mos_editline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x0a-mos_fopen" class="md-nav__link">
    <span class="md-ellipsis">
      0x0A: mos_fopen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x0b-mos_fclose" class="md-nav__link">
    <span class="md-ellipsis">
      0x0B: mos_fclose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x0c-mos_fgetc" class="md-nav__link">
    <span class="md-ellipsis">
      0x0C: mos_fgetc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x0d-mos_fputc" class="md-nav__link">
    <span class="md-ellipsis">
      0x0D: mos_fputc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x0e-mos_feof" class="md-nav__link">
    <span class="md-ellipsis">
      0x0E: mos_feof
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x0f-mos_geterror" class="md-nav__link">
    <span class="md-ellipsis">
      0x0F: mos_getError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x10-mos_oscli" class="md-nav__link">
    <span class="md-ellipsis">
      0x10: mos_oscli
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x11-mos_copy" class="md-nav__link">
    <span class="md-ellipsis">
      0x11: mos_copy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x12-mos_getrtc" class="md-nav__link">
    <span class="md-ellipsis">
      0x12: mos_getrtc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x13-mos_setrtc" class="md-nav__link">
    <span class="md-ellipsis">
      0x13: mos_setrtc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x14-mos_setintvector" class="md-nav__link">
    <span class="md-ellipsis">
      0x14: mos_setintvector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x15-mos_uopen" class="md-nav__link">
    <span class="md-ellipsis">
      0x15: mos_uopen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x16-mos_uclose" class="md-nav__link">
    <span class="md-ellipsis">
      0x16: mos_uclose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x17-mos_ugetc" class="md-nav__link">
    <span class="md-ellipsis">
      0x17: mos_ugetc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x18-mos_uputc" class="md-nav__link">
    <span class="md-ellipsis">
      0x18: mos_uputc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x19-mos_getfil" class="md-nav__link">
    <span class="md-ellipsis">
      0x19: mos_getfil
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x1a-mos_fread" class="md-nav__link">
    <span class="md-ellipsis">
      0x1A: mos_fread
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x1b-mos_fwrite" class="md-nav__link">
    <span class="md-ellipsis">
      0x1B: mos_fwrite
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x1c-mos_flseek" class="md-nav__link">
    <span class="md-ellipsis">
      0x1C: mos_flseek
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x1d-mos_setkbvector" class="md-nav__link">
    <span class="md-ellipsis">
      0x1D: mos_setkbvector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x1e-mos_getkbmap" class="md-nav__link">
    <span class="md-ellipsis">
      0x1E: mos_getkbmap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x1f-mos_i2c_open" class="md-nav__link">
    <span class="md-ellipsis">
      0x1F: mos_i2c_open
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x20-mos_i2c_close" class="md-nav__link">
    <span class="md-ellipsis">
      0x20: mos_i2c_close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x21-mos_i2c_write" class="md-nav__link">
    <span class="md-ellipsis">
      0x21: mos_i2c_write
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x22-mos_i2c_read" class="md-nav__link">
    <span class="md-ellipsis">
      0x22: mos_i2c_read
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fatfs-commands" class="md-nav__link">
    <span class="md-ellipsis">
      FatFS commands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FatFS commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#0x80-ffs_fopen" class="md-nav__link">
    <span class="md-ellipsis">
      0x80: ffs_fopen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x81-ffs_fclose" class="md-nav__link">
    <span class="md-ellipsis">
      0x81: ffs_fclose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x82-ffs_fread" class="md-nav__link">
    <span class="md-ellipsis">
      0x82: ffs_fread
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x83-ffs_fwrite" class="md-nav__link">
    <span class="md-ellipsis">
      0x83: ffs_fwrite
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x84-ffs_fseek" class="md-nav__link">
    <span class="md-ellipsis">
      0x84: ffs_fseek
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x8e-ffs_feof" class="md-nav__link">
    <span class="md-ellipsis">
      0x8E: ffs_feof
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x91-ffs_dopen" class="md-nav__link">
    <span class="md-ellipsis">
      0x91: ffs_dopen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x92-ffs_dclose" class="md-nav__link">
    <span class="md-ellipsis">
      0x92: ffs_dclose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x93-ffs_dread" class="md-nav__link">
    <span class="md-ellipsis">
      0x93: ffs_dread
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x96-ffs_stat" class="md-nav__link">
    <span class="md-ellipsis">
      0x96: ffs_stat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#0x9e-ffs_getcwd" class="md-nav__link">
    <span class="md-ellipsis">
      0x9E: ffs_getcwd
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system-variables" class="md-nav__link">
    <span class="md-ellipsis">
      System Variables
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/AgonConsole8/agon-docs/edit/main/docs/MOS-API.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


<h1 id="what-is-the-mos-api">What is the MOS API</h1>
<p>The MOS API can be used by external applications to access MOS functionality.</p>
<p>Please note that this documentation uses assembler in the examples in a format that is compatible with the Zilog ZDS II assembler.  The assembler syntax used in BBC BASIC is similar, but not identical.  Additionally you will need to use the new ADL version of BBC BASIC to use the new eZ80 ADL mode and extended instruction set.</p>
<p>This documentation is not intended as a tutorial on eZ80 assembler, but as a reference for those who are already familiar with the eZ80 or Z80 instruction set and wish to use MOS APIs in their programs.</p>
<h2 id="usage-from-z80-assembler">Usage from Z80 assembler</h2>
<p>There are four RST instructions for accessing MOS functionality from Z80.</p>
<ul>
<li><code>RST 00h</code>: Reset the eZ80</li>
<li><code>RST 08h</code>: Execute a MOS command</li>
<li><code>RST 10h</code>: Output a single character to the VDP</li>
<li><code>RST 18h</code>: Output a stream of characters to the VDP (MOS 1.03 or above)</li>
</ul>
<p>In addition, if you are using the Zilog ZDS II assembler you may wish to include the file <code>mos_api.inc</code> in your project.  The Console8 version can be found in the folder <a href="https://github.com/AgonConsole8/agon-mos/tree/main/src">src</a> of project <a href="https://github.com/AgonConsole8/agon-mos">agon-mos</a>.  The original Quark versions of this file can be found in the folder <a href="https://github.com/breakintoprogram/agon-mos/tree/main/src">src</a> of project <a href="https://github.com/breakintoprogram/agon-mos">agon-mos</a>.</p>
<p>NB:</p>
<ul>
<li>Using the <code>RST.LIS</code> opcode in an eZ80 assembler will ensure the MOS RST instructions are called regardless of the eZ80s current addressing mode.</li>
<li>In the <code>mos_api.inc</code> file you will find:</li>
<li>EQUs for all the MOS commands, data structures and system variables.</li>
<li>An incomplete list of VDP control variables.  For a full list, see the <a href="../VDP/">VDP documentation</a></li>
<li>A complete list FatFS APIs, however these are not yet all implemented in MOS.  Those that are implemented are documented below.</li>
</ul>
<p>Further information on the <code>RST</code> handlers provided by MOS are as follows:</p>
<h3 id="rst-08h-execute-a-mos-command"><code>RST 08h</code>: Execute a MOS command</h3>
<p>Parameters:</p>
<ul>
<li><code>A</code>: MOS command number to execute</li>
</ul>
<p>NB:</p>
<ul>
<li>There is a macro in <code>mos_api.inc</code> with EQUs for all the MOS commands</li>
<li>Other MOS-command dependant parameters may be required</li>
</ul>
<p>Macro:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>;
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>; Macro for calling the API
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>; Parameters:
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>; - `F`unction: One of the function numbers listed above
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>;
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>MOSCALL:    MACRO   function
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        LD  A, function
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>        RST.LIS 08h
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>        ENDMACRO    
</code></pre></div>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>; OSRDCH: Read a character in from the ESP32 keyboard handler
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>;
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>OSRDCH:     MOSCALL mos_getkey
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>        OR  A       
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>        JR  Z, OSRDCH       ; Loop until key is pressed
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>        RET
</code></pre></div>
<h3 id="rst-10h-output-a-single-character-to-the-vdp"><code>RST 10h</code>: Output a single character to the VDP</h3>
<p>Parameters:</p>
<ul>
<li><code>A</code>: Character to output</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>; OSWRCH: Write a character out to the ESP32 VDU handler via the MOS
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>; A: Character to write
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>;
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>OSWRCH:     RST.LIS 10h         ; This calls a RST in the eZ80 address space
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>        RET
</code></pre></div>
<h3 id="rst-18h-output-a-stream-of-characters-to-the-vdp-mos-103-or-above"><code>RST 18h</code>: Output a stream of characters to the VDP (MOS 1.03 or above)</h3>
<p>Parameters:</p>
<ul>
<li><code>HL(U)</code>: Address of the data stream (16-bit for Z80 mode, 24-bit for ADL mode)</li>
<li><code>BC</code>: Length of stream (or 0 if the stream is delimited)</li>
<li><code>A</code>: Stream delimiter (if <code>BC</code>=0)</li>
</ul>
<p>Returns:
- <code>A</code>: Last character displayed (length mode) OR Delimeter (delimeter mode)
- <code>BC</code>: 0
- <code>HL(U)</code>: Address of last character displayed + 1 (length mode) OR location of delimeter (delimeter mode)
- <code>E</code>: Value of <code>A</code> upon entry</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>; Write a stream of characters to the VDP
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>; HLU: Address of buffer containing data - if in 16-bit segment, U will be replaced by MB
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>;  BC: Number of characters to write out, or 0 if the data is delimited
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>;   A: End of data delimiter, i.e. 0 for C strings
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>;
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        LD  HL, text        ; Address of text
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>        LD  BC, 0           ; Set to 0, so length ignored...
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>        LD  A, 0            ; Use character in A as delimiter
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>        RST.LIS 18h         ; This calls a RST in the eZ80 address space
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>        RET
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>;
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>text:       DB  &quot;Hello World&quot;, 0
</code></pre></div>
<h2 id="the-mos-api">The MOS API</h2>
<p>MOS API calls can be executed from a classic 64K Z80 segment or whilst the eZ80 is running in 24-bit ADL mode. For classic mode, 16 bit registers are passed as pointers to the MOS commands; these are automatically promoted to 24 bit by adding the MB register to bits 16-23 of the register. When running in ADL mode, a 24-bit register will be passed, but MB must be set to 0.</p>
<p>The following MOS commands are supported:</p>
<h3 id="0x00-mos_getkey"><code>0x00</code>: mos_getkey</h3>
<p>Read a keypress from the VDP</p>
<p>Parameters: None</p>
<p>Returns:
- <code>A</code>: The keycode of the character pressed</p>
<h3 id="0x01-mos_load"><code>0x01</code>: mos_load</h3>
<p>Load a file from SD card</p>
<p>Parameters: 
- <code>HL(U)</code>: Address of filename (zero terminated)
- <code>DE(U)</code>: Address at which to load
- <code>BC(U)</code>: Maximum allowed size (bytes)</p>
<p>Preserves: <code>HL(U)</code>, <code>DE(U)</code>, <code>BC(U)</code></p>
<p>Returns:
- <code>A</code>: File error, or 0 if OK
- <code>F</code>: Carry reset if no room for file, otherwise set</p>
<h3 id="0x02-mos_save"><code>0x02</code>: mos_save</h3>
<p>Save a file to SD card</p>
<p>Parameters: </p>
<ul>
<li><code>HL(U)</code>: Address of filename (zero terminated)</li>
<li><code>DE(U)</code>: Address to save from</li>
<li><code>BC(U)</code>: Number of bytes to save</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>DE(U)</code>, <code>BC(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: File error, or 0 if OK</li>
<li><code>F</code>: Carry set</li>
</ul>
<h3 id="0x03-mos_cd"><code>0x03</code>: mos_cd</h3>
<p>Change current directory on the SD card</p>
<p>Parameters: </p>
<ul>
<li><code>HL(U)</code>: Address of path (zero terminated)</li>
</ul>
<p>Preserves: <code>HL(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: File error, or 0 if OK</li>
</ul>
<h3 id="0x04-mos_dir"><code>0x04</code>: mos_dir</h3>
<p>List SD card folder contents to screen.</p>
<p>This is a simple directory listing command that will list the contents of the current directory to the screen.  More advanced directory listing functionality for applications to use is available via the <a href="#fatfs-commands">FatFS commands API</a>.</p>
<p>Parameters: </p>
<ul>
<li><code>HL(U)</code>: Address of path (zero terminated)</li>
</ul>
<p>Preserves: <code>HL(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: File error, or 0 if OK</li>
</ul>
<h3 id="0x05-mos_del"><code>0x05</code>: mos_del</h3>
<p>Delete a file or folder from the SD card</p>
<p>Parameters: </p>
<ul>
<li><code>HL(U)</code>: Address of path (zero terminated)</li>
</ul>
<p>Preserves: <code>HL(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: File error, or 0 if OK</li>
</ul>
<h3 id="0x06-mos_ren"><code>0x06</code>: mos_ren</h3>
<p>Rename a file on the SD card</p>
<p>Parameters: </p>
<ul>
<li><code>HL(U)</code>: Address of filename1 (zero terminated)</li>
<li><code>DE(U)</code>: Address of filename2 (zero terminated)</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>DE(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: File error, or 0 if OK</li>
</ul>
<h3 id="0x07-mos_mkdir"><code>0x07</code>: mos_mkdir</h3>
<p>Make a folder on the SD card</p>
<p>Parameters: </p>
<ul>
<li><code>HL(U)</code>: Address of path (zero terminated)</li>
</ul>
<p>Preserves: <code>HL(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: File error, or 0 if OK</li>
</ul>
<h3 id="0x08-mos_sysvars"><code>0x08</code>: mos_sysvars</h3>
<p>Fetch a pointer to the <a href="#system-variables">system variables</a></p>
<p>Parameters: None</p>
<p>Returns:</p>
<ul>
<li><code>IXU</code>: Pointer to the MOS system variable area (this is always 24 bit)</li>
</ul>
<h3 id="0x09-mos_editline"><code>0x09</code>: mos_editline</h3>
<p>Invoke the line editor</p>
<p>Parameters: </p>
<ul>
<li><code>HL(U)</code>: Address of the buffer</li>
<li><code>BC(U)</code>: Buffer length</li>
<li><code>E</code>: Flags to control editor behaviour</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>BC(U)</code>, <code>DE(U)</code></p>
<p>Returns:
- <code>A</code>: Key that was used to exit the input loop (CR=13, ESC=27)</p>
<p>Editor behaviour flags are as follows:
| Bit | Description |
| --- | ----------- |
| 0   | When set, buffer will be cleared before use |
| 1   | When set, tab-completion for MOS commands and files is enabled * |
| 2   | When set, hotkeys are <em>disabled</em> * |
| 3   | When set, input history will be <em>disabled</em> * |
| 4-7 | Reserved for future use (for future compatibility, ensure these are set to zero) |</p>
<p>* Support for editor control flags was added in Console8 MOS 2.2.0.  Prior to this the only documented values for <code>E</code> were 0 and 1 to indicate whether the buffer should be cleared.</p>
<h3 id="0x0a-mos_fopen"><code>0x0A</code>: mos_fopen</h3>
<p>Get a file handle</p>
<p>Parameters: </p>
<ul>
<li><code>HL(U)</code>: Address of filename (zero terminated)</li>
<li><code>C</code>: Mode</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>BC(U)</code>, <code>DE(U)</code>, <code>IX(U)</code>, <code>IY(U)</code></p>
<p>Returns:
- <code>A</code>: Filehandle, or 0 if couldn't open</p>
<p>Mode can be one of: fa_read, fa_write, fa_open_existing, fa_create_new, fa_create_always, fa_open_always or fa_open_append</p>
<p>NB: If you open the file using mos_fopen, you must close it using mos_fclose, not ffs_api_fclose</p>
<h3 id="0x0b-mos_fclose"><code>0x0B</code>: mos_fclose</h3>
<p>Close a file handle</p>
<p>Parameters: </p>
<ul>
<li><code>C</code>: Filehandle, or 0 to close all open files</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>BC(U)</code>, <code>DE(U)</code>, <code>IX(U)</code>, <code>IY(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: Number of files still open</li>
</ul>
<h3 id="0x0c-mos_fgetc"><code>0x0C</code>: mos_fgetc</h3>
<p>Get a character from an open file</p>
<p>Parameters: </p>
<ul>
<li><code>C</code>: Filehandle</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>BC(U)</code>, <code>DE(U)</code>, <code>IX(U)</code>, <code>IY(U)</code></p>
<p>Returns:
- <code>A</code>: Character read
- <code>F</code>: C set if last character in file, otherwise NC (MOS 1.04 or greater)</p>
<h3 id="0x0d-mos_fputc"><code>0x0D</code>: mos_fputc</h3>
<p>Write a character to an open file</p>
<p>Parameters: </p>
<ul>
<li><code>C</code>: Filehandle</li>
<li><code>B</code>: Character to write</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>BC(U)</code>, <code>DE(U)</code>, <code>IX(U)</code>, <code>IY(U)</code></p>
<p>Returns: None</p>
<h3 id="0x0e-mos_feof"><code>0x0E</code>: mos_feof</h3>
<p>Check for end of file</p>
<p>Parameters: </p>
<ul>
<li><code>C</code>: Filehandle</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>BC(U)</code>, <code>DE(U)</code>, <code>IX(U)</code>, <code>IY(U)</code></p>
<p>Returns:
- <code>A</code>: 1 if at end of file, otherwise 0</p>
<h3 id="0x0f-mos_geterror"><code>0x0F</code>: mos_getError</h3>
<p>Copy an error string to a buffer</p>
<p>Parameters: </p>
<ul>
<li><code>E</code>: The error code</li>
<li><code>HL(U)</code>: Address of buffer to copy message into</li>
<li><code>BC(U)</code>: Size of buffer</li>
</ul>
<p>Preserves: <code>DE(U)</code>, <code>HL(U)</code>, <code>BC(U)</code></p>
<p>Returns: None</p>
<h3 id="0x10-mos_oscli"><code>0x10</code>: mos_oscli</h3>
<p>Execute a MOS command</p>
<p>Parameters: </p>
<ul>
<li><code>HL(U)</code>: Pointer the the MOS command string</li>
</ul>
<p>Preserves: <code>HL(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: MOS error code</li>
</ul>
<p>NB previously documentation for this command was incorrect, as it documented additional parameters in <code>DE(U)</code> and <code>BC(U)</code>.  These registers are not currently used.</p>
<h3 id="0x11-mos_copy"><code>0x11</code>: mos_copy</h3>
<p>Copy a file on the SD card</p>
<p>Parameters: </p>
<ul>
<li><code>HL(U)</code>: Address of filename1 (zero terminated)</li>
<li><code>DE(U)</code>: Address of filename2 (zero terminated)</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>BC(U)</code>, <code>DE(U)</code>, <code>IX(U)</code>, <code>IY(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: File error, or 0 if OK</li>
</ul>
<p>NB: Requires MOS 1.03 or greater</p>
<h3 id="0x12-mos_getrtc"><code>0x12</code>: mos_getrtc</h3>
<p>Get a time string from the RTC (Requires MOS 1.03 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>HL(U)</code>: Pointer to a buffer to copy the string to (at least 32 bytes)</li>
</ul>
<p>Preserves: <code>HL(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: Length of time string</li>
</ul>
<h3 id="0x13-mos_setrtc"><code>0x13</code>: mos_setrtc</h3>
<p>Set the RTC (Requires MOS 1.03 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>HL(U)</code>: Pointer to a 6-byte buffer with the time data in</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>+0: Year (offset from 1980, so 1989 is 9)
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>+1: Month (1 to 12)
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>+2: Day of Month (1 to 31)
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>+3: Hour (0 to 23)
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>+4: Minute (0 to 59)
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>+5: Second (0 to 59)
</code></pre></div>
<p>Preserves: <code>HL(U)</code></p>
<p>Returns: None</p>
<h3 id="0x14-mos_setintvector"><code>0x14</code>: mos_setintvector</h3>
<p>Set an interrupt vector (Requires MOS 1.03 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>E</code>: Interrupt vector number to set</li>
<li><code>HLU</code>: Address of new interrupt vector (24-bit pointer)</li>
</ul>
<p>Preserves: <code>HLU</code>, <code>DEU</code></p>
<p>Returns:</p>
<ul>
<li><code>HL(U)</code>: Address of the previous interrupt vector (24-bit pointer)</li>
</ul>
<h3 id="0x15-mos_uopen"><code>0x15</code>: mos_uopen</h3>
<p>Open UART1 (Requires MOS 1.03 or above)</p>
<p>To handle the received interrupts, you will need to assign a handler to UART1's interrupt vector (0x1A).</p>
<p>Parameters:</p>
<ul>
<li><code>IXU</code>: Pointer to a UART struct</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>+0: Baud rate (24-bit, little endian)
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>+3: Data bits (5, 6, 7 or 8)
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>+4: Stop bits (1 or 2)
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>+5: Parity bits (0: None, 1: Odd, 3: Even)
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>+6: Flow control (0: None, 1: Hardware)
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>+7: Enabled interrupts
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    - Bit 0: Set to enable received data interrupt
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    - Bit 1: Set to enable transmit data interrupt
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    - Bit 2: Set to enable line status change interrupt
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    - Bit 3: Set to enable modem status change interrupt
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>    - Bit 4: Set to enable transmit complete interrupt
</code></pre></div>
<p>Preserves: <code>HL(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: Error code (always 0)</li>
</ul>
<h3 id="0x16-mos_uclose"><code>0x16</code>: mos_uclose</h3>
<p>Close UART1 (Requires MOS 1.03 or above)</p>
<h3 id="0x17-mos_ugetc"><code>0x17</code>: mos_ugetc</h3>
<p>Read a character from UART1 (Requires MOS 1.03 or above)</p>
<p>Returns:</p>
<ul>
<li><code>A</code>: The character read</li>
<li><code>F</code>: C if successful, NC if the UART is closed</li>
</ul>
<h3 id="0x18-mos_uputc"><code>0x18</code>: mos_uputc</h3>
<p>Write a character to UART1 (Requires MOS 1.03 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>C</code>: The character to write</li>
</ul>
<p>Returns:</p>
<ul>
<li><code>F</code>: C if successful, NC if the UART is closed</li>
</ul>
<h3 id="0x19-mos_getfil"><code>0x19</code>: mos_getfil</h3>
<p>Get a pointer to a FIL structure in MOS (Requires MOS 1.03 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>C</code>: Filehandle</li>
</ul>
<p>Preserves: <code>BC(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>HLU</code>: 24-bit pointer to a FIL structure (in MOS RAM)</li>
</ul>
<h3 id="0x1a-mos_fread"><code>0x1A</code>: mos_fread</h3>
<p>Read a block of data from a file (Requires MOS 1.03 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>C</code>: Filehandle</li>
<li><code>HLU</code>: Pointer to a buffer to read the data into</li>
<li><code>DEU</code>: Number of bytes to read</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>BC(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>DEU</code>: Number of bytes read</li>
</ul>
<h3 id="0x1b-mos_fwrite"><code>0x1B</code>: mos_fwrite</h3>
<p>Write a block of data to a file (Requires MOS 1.03 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>C</code>: Filehandle</li>
<li><code>HLU</code>: Pointer to a buffer that contains the data to write </li>
<li><code>DEU</code>: Number of bytes to write out</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>BC(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>DEU</code>: Number of bytes written</li>
</ul>
<h3 id="0x1c-mos_flseek"><code>0x1C</code>: mos_flseek</h3>
<p>Move the read/write pointer in a file (Requires MOS 1.03 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>C</code>: Filehandle</li>
<li><code>HLU</code>: Least significant 3 bytes of the offset from the start of the file</li>
<li><code>E</code>: Most significant byte of the offset (set to 0 for files &lt; 16MB)</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>BC(U)</code>, <code>DE(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: FRESULT</li>
</ul>
<h3 id="0x1d-mos_setkbvector"><code>0x1D</code>: mos_setkbvector</h3>
<p>Allows user programs to access VDP keyboard packets without overriding the entire uart0 interrupt handler.
The user program registered, will be called during the uart0 interrupt handler, being passed the address of the full VDP keyboard packet. Normal MOS key handling is disabled when a user program is registered.</p>
<p>Parameters:</p>
<ul>
<li><code>C</code>: Address length in HL (0 = 24bit, 1 = 16bit). If 1 then set the top byte of HLU(callback address) to MB (for ADL=0 callers)</li>
<li><code>HL(U)</code>: Callback address of user program to register, or 0 to clear any previously registered vector</li>
</ul>
<p>Returns: Nothing upon registration. The user program can expect the full VDP packet address in DE(24-bit) upon entry.</p>
<p><a href="https://github.com/tomm/agon-mos/blob/main/bin/kbvector.asm">example code</a> that registers a custom handler.</p>
<h3 id="0x1e-mos_getkbmap"><code>0x1E</code>: mos_getkbmap</h3>
<p>Fetch a pointer to the virtual keyboard map (Requires MOS 1.04 RC2 or above)</p>
<p>Parameters: None</p>
<p>Returns:</p>
<ul>
<li><code>IXU</code>: Pointer to the keyboard bitmap (this is always 24 bit)</li>
</ul>
<h3 id="0x1f-mos_i2c_open"><code>0x1F</code>: mos_i2c_open</h3>
<p>Open the I2C bus as Master (Requires MOS 1.04 RC3 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>C</code>: Frequency ID (1: 57600, 2: 115200, 3: 230400)</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>BC(U)</code>, <code>DE(U)</code>, <code>IX(U)</code>, <code>IY(U)</code></p>
<p>Returns: None</p>
<h3 id="0x20-mos_i2c_close"><code>0x20</code>: mos_i2c_close</h3>
<p>Close the I2C bus (Requires MOS 1.04 RC3 or above)</p>
<p>Parameters: None</p>
<p>Preserves: <code>HL(U)</code>, <code>BC(U)</code>, <code>DE(U)</code>, <code>IX(U)</code>, <code>IY(U)</code></p>
<p>Returns: None</p>
<h3 id="0x21-mos_i2c_write"><code>0x21</code>: mos_i2c_write</h3>
<p>Write a block of bytes to the I2C bus (Requires MOS 1.04 RC3 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>C</code>: I2C Address</li>
<li><code>B</code>: Number of bytes to write (maximum 32)</li>
<li><code>HL(U)</code>: Pointer to a buffer to read the bytes from</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>DE(U)</code>, <code>IX(U)</code>, <code>IY(U)</code></p>
<p>Returns:
- <code>A</code>: Status
    - <code>0</code>: OK
    - <code>1</code>: No response from I2C slave
    - <code>2</code>: Data NACK
    - <code>4</code>: Bus arbitration lost
    - <code>8</code>: Bus error</p>
<h3 id="0x22-mos_i2c_read"><code>0x22</code>: mos_i2c_read</h3>
<p>Read a block of bytes from the I2C bus (Requires MOS 1.04 RC3 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>C</code>: I2C Address</li>
<li><code>B</code>: Number of bytes to read (maximum 32)</li>
<li><code>HL(U)</code>: Pointer to a buffer to write the bytes to</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>DE(U)</code>, <code>IX(U)</code>, <code>IY(U)</code></p>
<p>Returns:
- <code>A</code>: Status
    - <code>0</code>: OK
    - <code>1</code>: No response from I2C slave
    - <code>2</code>: Data NACK
    - <code>4</code>: Bus arbitration lost
    - <code>8</code>: Bus error</p>
<hr />
<h2 id="fatfs-commands">FatFS commands</h2>
<p>MOS makes use of FatFS to access the SD card.  Some of FatFS's functionality is exposed via the MOS API.  The exact API calls listed here may be expanded in later versions of MOS.</p>
<p>For more information on FatFS data structures and functions, see the <a href="http://elm-chan.org/fsw/ff/00index_e.html">FatFS documentation</a>.</p>
<h3 id="0x80-ffs_fopen"><code>0x80</code>: ffs_fopen</h3>
<p>Open a file (Requires MOS 1.03 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>HL(U)</code>: Pointer to an empty FIL structure</li>
<li><code>DE(U)</code>: Pointer to a C (zero-terminated) filename string</li>
<li><code>C</code>: File open mode</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>DE(U)</code>, <code>C</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: FRESULT</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>            LD  HL, fil             ; FIL buffer
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>            LD  DE, filename            ; Filename (0 terminated)
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>            LD  C, fa_read          ; Mode
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>            MOSCALL ffs_fopen           ; Open the file
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>            LD  DE, buffer          ; Where to store the read file
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>            LD  BC, 256             ; Number of bytes to read
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>            MOSCALL ffs_fread           ; Read the data in
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>            PUSH    BC              ; Preserve number of bytes read
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>            MOSCALL ffs_fclose          ; Close the file
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>            POP BC              ; BC: Number of bytes read
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>            RET 
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>filename:       DB  &quot;example.txt&quot;, 0        ; The file to read
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>fil:            DS  FIL_SIZE            ; FIL buffer (defined in mos_api.inc)
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>buffer:         DS  256             ; Buffer for storing read data
</code></pre></div>
<h3 id="0x81-ffs_fclose"><code>0x81</code>: ffs_fclose</h3>
<p>Close a file (Requires MOS 1.03 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>HL(U)</code>: Pointer to a FIL structure</li>
</ul>
<p>Preserves: <code>HL(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: FRESULT</li>
</ul>
<p>See ffs_fopen for an example</p>
<h3 id="0x82-ffs_fread"><code>0x82</code>: ffs_fread</h3>
<p>Read from a file (Requires MOS 1.03 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>HL(U)</code>: Pointer to a FIL structure</li>
<li><code>DE(U)</code>: Pointer to a buffer to store the data in</li>
<li><code>BC(U)</code>: Number of bytes to read (typically the size of the buffer)</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>DE(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>BC(U)</code>: Number of bytes read</li>
<li><code>A</code>: FRESULT</li>
</ul>
<p>See ffs_fopen for an example</p>
<h3 id="0x83-ffs_fwrite"><code>0x83</code>: ffs_fwrite</h3>
<p>Write to a file (Requires MOS 1.03 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>HL(U)</code>: Pointer to a FIL structure</li>
<li><code>DE(U)</code>: Pointer to a buffer to read the data from</li>
<li><code>BC(U)</code>: Number of bytes to write (typically the size of the buffer)</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>DE(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>BC(U)</code>: Number of bytes written</li>
<li><code>A</code>: FRESULT</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>            LD  HL, fil             ; FIL buffer
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>            LD  DE, filename            ; Filename (0 terminated)
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>            LD  C, fa_write | fa_create_always  ; Mode
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>            MOSCALL ffs_fopen           ; Open the file
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>            LD  DE, buffer          ; Location of data to write
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>            LD  BC, 256             ; Number of bytes to write
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>            MOSCALL ffs_write           ; Write the data
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>            MOSCALL ffs_fclose          ; Close the file
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>            RET 
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>filename:       DB  &quot;example.txt&quot;, 0        ; The file to read
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>fil:            DS  FIL_SIZE            ; FIL buffer (defined in mos_api.inc)
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>buffer:         DS  256             ; Buffer containing data to write out
</code></pre></div>
<h3 id="0x84-ffs_fseek"><code>0x84</code>: ffs_fseek</h3>
<p>Move the read/write pointer in a file (Requires MOS 1.03 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>HL(U)</code>: Pointer to a FIL structure</li>
<li><code>DE(U)</code>: Least significant 3 bytes of the offset from the start of the file</li>
<li><code>C</code>: Most significant byte of the offset (set to 0 for files &lt; 16MB)</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>DE(U)</code>, <code>BC(U)</code></p>
<h3 id="0x8e-ffs_feof"><code>0x8E</code>: ffs_feof</h3>
<p>Detect end of file (Requires MOS 1.03 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>HL(U)</code>: Pointer to a FIL structure</li>
</ul>
<p>Preserves: <code>HL(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: 1 if at the end of the file, otherwise 0</li>
</ul>
<h3 id="0x91-ffs_dopen"><code>0x91</code>: ffs_dopen</h3>
<p>Open a directory (Requires Console8 MOS 2.2.0 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>HL(U)</code>: Pointer to a blank DIR structure</li>
<li><code>DE(U)</code>: Pointer to a C (zero-terminated) directory path string</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>DE(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: FRESULT</li>
</ul>
<h3 id="0x92-ffs_dclose"><code>0x92</code>: ffs_dclose</h3>
<p>Close a directory (Requires Console8 MOS 2.2.0 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>HL(U)</code>: Pointer to a DIR structure</li>
</ul>
<p>Preserves: <code>HL(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: FRESULT</li>
</ul>
<h3 id="0x93-ffs_dread"><code>0x93</code>: ffs_dread</h3>
<p>Read next directory entry into a FILINFO data structure (Requires Console8 MOS 2.2.0 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>HL(U)</code>: Pointer to a DIR structure</li>
<li><code>DE(U)</code>: Pointer to a FILINFO structure</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>DE(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: FRESULT</li>
</ul>
<h3 id="0x96-ffs_stat"><code>0x96</code>: ffs_stat</h3>
<p>Get file information (Requires MOS 1.03 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>HL(U)</code>: Pointer to a FILINFO structure</li>
<li><code>DE(U)</code>: Pointer to a C (zero-terminated) filename string</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>DE(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: FRESULT</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>            LD  HL, filinfo         ; FILINFO buffer
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>            LD  DE, filename            ; Filename (0 terminated)
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>            MOSCALL ffs_stat
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>            RET
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>filename:       DB  &quot;example.txt&quot;, 0        ; The file to read
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>filinfo:        DS  FILINFO_SIZE            ; FILINFO buffer (defined in mos_api.inc)
</code></pre></div>
<h3 id="0x9e-ffs_getcwd"><code>0x9E</code>: ffs_getcwd</h3>
<p>Get the current working directory (Requires Console8 MOS 2.2.0 or above)</p>
<p>Parameters:</p>
<ul>
<li><code>HL(U)</code>: Pointer to a buffer to store the directory path in</li>
<li><code>BC(U)</code>: Maximum length of the buffer</li>
</ul>
<p>Preserves: <code>HL(U)</code>, <code>BC(U)</code></p>
<p>Returns:</p>
<ul>
<li><code>A</code>: FRESULT</li>
</ul>
<hr />
<h2 id="system-variables">System Variables</h2>
<p>The MOS API command <a href="#0x08-mos_sysvars">mos_sysvars</a> returns a pointer to the base of the MOS system variables area in IXU - <code>A</code> 24-bit pointer.</p>
<p>The following system variables are available in <a href="#usage-from-z80-assembler">mos_api.inc</a>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>; System variable indexes for api_sysvars
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>; Index into _sysvars in globals.asm
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>;
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>sysvar_time:        EQU 00h ; 4: Clock timer in centiseconds (incremented by 2 every VBLANK)
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>sysvar_vpd_pflags:  EQU 04h ; 1: Flags to indicate completion of VDP commands
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>sysvar_keyascii:    EQU 05h ; 1: ASCII keycode, or 0 if no key is pressed
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>sysvar_keymods:     EQU 06h ; 1: Keycode modifiers
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>sysvar_cursorX:     EQU 07h ; 1: Cursor X position
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>sysvar_cursorY:     EQU 08h ; 1: Cursor Y position
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>sysvar_scrchar:     EQU 09h ; 1: Character read from screen
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>sysvar_scrpixel:    EQU 0Ah ; 3: Pixel data read from screen (R,B,G)
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>sysvar_audioChannel:    EQU 0Dh ; 1: Audio channel 
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>sysvar_audioSuccess:    EQU 0Eh ; 1: Audio channel note queued (0 = no, 1 = yes)
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>sysvar_scrWidth:    EQU 0Fh ; 2: Screen width in pixels
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>sysvar_scrHeight:   EQU 11h ; 2: Screen height in pixels
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>sysvar_scrCols:     EQU 13h ; 1: Screen columns in characters
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>sysvar_scrRows:     EQU 14h ; 1: Screen rows in characters
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>sysvar_scrColours:  EQU 15h ; 1: Number of colours displayed
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>sysvar_scrpixelIndex:   EQU 16h ; 1: Index of pixel data read from screen
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>sysvar_vkeycode:    EQU 17h ; 1: Virtual key code from FabGL
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>sysvar_vkeydown     EQU 18h ; 1: Virtual key state from FabGL (0=up, 1=down)
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>sysvar_vkeycount:   EQU 19h ; 1: Incremented every time a key packet is received
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>sysvar_rtc:     EQU 1Ah ; 8: Real time clock data
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>sysvar_keydelay:    EQU 22h ; 2: Keyboard repeat delay
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>sysvar_keyrate:     EQU 24h ; 2: Keyboard repeat rate
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>sysvar_keyled:      EQU 26h ; 1: Keyboard LED status
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>sysvar_scrMode:     EQU 27h ; 1: Screen mode (from MOS 1.04)
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>sysvar_rtc_enable:  EQU 28h ; 1: RTC enable status (from Console8 MOS 2.0.0)
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>sysvar_mouseX:      EQU 29h ; 2: Mouse X position
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>sysvar_mouseY:      EQU 2Bh ; 2: Mouse Y position
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>sysvar_mouseButtons:    EQU 2Dh ; 1: Mouse left+right+middle buttons (bits 0-2, 0=up, 1=down)
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>sysvar_mouseWheel:      EQU 2Eh ; 1: Mouse wheel delta
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>sysvar_mouseXDelta:     EQU 2Fh ; 2: Mouse X delta
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>sysvar_mouseYDelta:     EQU 31h ; 2: Mouse Y delta
</code></pre></div>
Example: Reading a virtual keycode in ADL mode (24-bit):
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>        MOSCALL mos_getkey
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>        LD  A, (IX + sysvar_vkeycode)   ; Load A with the virtual keycode from FabGL
</code></pre></div>
Example: Reading a virtual keycode in Z80 mode (16-bit):
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>        MOSCALL mos_getkey
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>        LD.LIL  A, (IX + sysvar_vkeycode)   ; Load A with the virtual keycode from FabGL
</code></pre></div></p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "navigation.expand", "navigation.instant", "navigation.instant.preview", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotate", "content.code.annotation", "content.code.copy", "content.footnote.tooltips", "content.action.edit"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.a7c05c9e.min.js"></script>
      
    
  </body>
</html>